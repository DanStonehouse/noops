<!DOCTYPE html>
<html>
<head>
  <title> Dans Maze </title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js">
  </script>
</head>
<body>
<h1> Mazebot </h1>
<p> Welcome to Mazebot </p>
<h4 id="mazename"></h4>
<h4 id="startpoint"></h4>
<h4 id="endpoint"></h4>
<h4 id="exsol"></h4>
<h4 id="currentCol"></h4>
<h4 id="currentRow"></h4>
<h4 id="mapSize"></h4>

<p id="map"></p>
<button id="newMap">New Map</button>
<button id="Left">Left</button>
<button id="Right">Right</button>
<button id="Up">Up</button>
<button id="Down">Down</button>
<script>
$(document).ready(function(){
  var currentCol;
  var currentRow;
  var mapSize;
  var complete = false;

  $(document).keydown(function(e) {
    switch(e.which) {
        case 37: // left
          moveLeft();
          break;
        case 38: // up
          moveUp();
          break;
        case 39: // right
          moveRight();
        break;
        case 40: // down
          moveDown();
          break;

        default: return; // exit this handler for other keys
    }
    e.preventDefault(); // prevent the default action (scroll / move caret)
});

  $("#Left").click(function(){
    moveLeft();
  });

  $("#Right").click(function(){
    moveRight();
  });

  $("#Up").click(function(){
    moveUp();
  });

  $("#Down").click(function(){
    moveDown();
  });

  function isWall(row,col){
    var id = "#" + row + "_" + col;
    var type = $(id).data("type");
    if (type == "wall"){
      return true;
    } else {
      return false;
    }

  }

  function moveUp(){
    if (currentRow > 0 && complete == false) {
      if( isWall(currentRow - 1, currentCol) == false ){
        console.log("Up");

        // set current tile to a space
        clearSpace();

        // decrease cuurentrow by 1
        currentRow --;

        // set new tile as current
        moveCharacter();

        // update currentCol text
        $('#currentRow').text("currentRow / " + currentRow);
      }
    } else {
      console.log("Unable Up");
    }
  }

  function moveDown(){
    if (currentRow < mapSize - 1 && complete == false) {
      if( isWall(currentRow + 1, currentCol) == false ){
        console.log("Down");

        // set current tile to a space
        clearSpace();

        // increase cuurentrow by 1
        currentRow ++;

        // set new tile as current
        moveCharacter();

        // update currentCol text
        $('#currentRow').text("currentRow / " + currentRow);
      }
    } else {
      console.log("Unable Down");
    }
  }

  function moveRight(){
    if (currentCol < mapSize - 1 && complete == false) {
      if( isWall(currentRow, currentCol + 1) == false ){
        console.log("Right");

        // set current tile to a space
        clearSpace();

        // increase cuurentcol by 1
        currentCol ++;

        // set new tile as current
        moveCharacter();

        // update currentCol text
        $('#currentCol').text("currentCol / " + currentCol);
      }
    } else {
      console.log("Unable Right");
    }
  }

  function moveLeft(){
    if (currentCol > 0 && complete == false) {
      if( isWall(currentRow, currentCol - 1) == false ){
        console.log("Left");

        // set current tile to a space
        clearSpace();

        // decrease cuurentcol by 1
        currentCol --;

        // set new tile as current
        moveCharacter();

        // update currentCol text
        $('#currentCol').text("currentCol / " + currentCol);
      }
    } else {
      console.log("Unable Left");
    }
  }

  function clearSpace(){
    var id = "#" + currentRow + "_" + currentCol;
    $(id).html("&#9608;");
    $(id).css({'color': 'Yellow', 'background-color': 'White'});
  }

  function moveCharacter(){
    id = "#" + currentRow + "_" + currentCol;

    // Check if tile is endpoint
    var type = $(id).data("type");
    console.log(type);
    if(type == "Finish"){
      complete = true;
      $("span").css({'color': 'Pink', 'background-color': 'Green'});
    } else {
      $(id).html("&#9608;");
      $(id).css({'color': 'Green'});
    }

  }

  $("#newMap").click(function(){
    // clear current text values
    $('#mazename').text("loading");
    $('#startpoint').text("loading");
    $('#endpoint').text("loading");
    $('#exsol').text("loading");
    $('#map').text("loading");
    $('#currentCol').text("loading");
    $('#currentRow').text("loading");
    $('#mapSize').text("loading");
    complete = false;

    $.get("https://api.noopschallenge.com/mazebot/random?minSize=10&maxSize=40", function(data, status){
      console.log(data);
      $('#mazename').text("mazename / " + data.name);
      $('#startpoint').text("startPoint x /  " + data.startingPosition[0] + " y / " + data.startingPosition[1]);
      $('#endpoint').text("endingPoint x / " + data.endingPosition[0] + " y / " + data.endingPosition[1]);
      $('#exsol').text("exsol / " + data.exampleSolution.directions);

      // set map size
      mapSize = data.map.length
      $('#mapSize').text("mapSize / " + mapSize);

      // clear loading message
      $('#map').text("");
      //loop through the array of map rows
      $.each(data.map, function( i, row ) {
        // loop through the array of columns
        $.each(row, function( j, column ) {
          var tile = column;
          if (tile == " ") {
            tile = "<span id='" + i + "_" + j + "' data-type='space' style='color:Silver'>&#9608;</span>";
          } else if (tile == "X"){
            tile = "<span id='" + i + "_" + j + "' data-type='wall' style='color:Navy'>&#9608;</span>";
          }  else if (tile == "A"){
            tile = "<span id='" + i + "_" + j + "' style='color:green;background-color:white'>&#9608;</span>";
            currentCol=j;
            currentRow=i;

            $('#currentCol').text("currentCol / " + currentCol);
            $('#currentRow').text("currentRow / " + currentRow);
          }  else if (tile == "B"){
            tile = "<span id='" + i + "_" + j + "' data-type='Finish' style='color:Purple;background-color:Red'>&#9608;</span>";
          }
          $('#map').append(tile);
        });
        $('#map').append("<br>");
      });
    });
  });
});
</script>
</body>
</html>
